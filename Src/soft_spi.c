/*



*/

#include "soft_spi.h"


/* 2MHz clock at 48MHz system clock, half-duplex*/

void spi_send_byte(uint8_t data) {
  // ????????? 1 ????
  for(uint32_t i=0; i<8; i++) {
		
    //CLRWDT();
		SCK_LOW;
		//__NOP();
    // ????????? ????? ??? = 1
    if (data & 0x80) {
      MOSI_HIGH; // ???????? 1
    }
    else {
      MOSI_LOW; // ???????? 0
    }
		
     // ?????????????
    data <<= 1;     // ????? ??? ???????? ???? ????
		__NOP();
		SCK_HIGH; // ?????????????
    __NOP();
    __NOP();
		__NOP();
    __NOP();
   }

}

uint8_t spi_read_byte(void) {
	//
	uint8_t spiReadData=0;
	//__NOP();
	//__NOP();
	//__NOP();
 
   for(uint32_t i=0; i<8; i++) {
     //CLRWDT();
     SCK_LOW; // ?????????????
     spiReadData <<= 1; // ????? ??? ???????? ???? ????
     __NOP();
		 __NOP();
		 __NOP();
		 __NOP();
		 __NOP();
		 __NOP();
		 //__NOP();
		 
		 SCK_HIGH; // ?????????????
     if (MISO_STATE != (uint32_t)GPIO_PIN_RESET) { spiReadData |= 0x01; } // ?????? ???
		 //__NOP();
		 //__NOP();
		 //__NOP();
   }
 
   return spiReadData;

}

